from blueshift.api import (symbol,
                            order,
                            date_rules,
                            time_rules,
                            get_open_positions,
                            set_cooloff_period,
                            schedule_once,
                            schedule_later,
                            get_open_orders,
                            square_off)

def initialize(context):
    context.asset1 = symbol('ITC')
    context.asset2 = symbol('TCS')
    context.freq = 60
    context.i = 1

    schedule_once(trade)

def trade(context, data):
    oid = order(context.asset1, 1)
    print(f"Order ID:{oid}")

    if oid:
        schedule_later(get_positions, 1)

def get_positions(context, data):
    open_order = get_open_orders()
    print(f"Open Order:{open_order}")
    open_positions = get_open_positions()
    print(f"Open Positions:{open_positions}")

    if open_positions:
        schedule_later(execute_square_off, 3)

def execute_square_off(context, data): 
    square_off()

def on_trade(context, data):
    print(f"{context.i} trade received")
    context.i+=1
